<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Phrase Bias Tutorial</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
  </style>
  <!-- CSS added by filter 'toc-css.lua' for TOC hovering to the side -->
  <style>
  body {
    padding-left: 1.5cm;
    padding-right: 1cm;
    transition: 0.5s;
  }
  nav {
    width: 1cm;
    margin-left: -1.5cm;
    font-size: smaller;
    color: grey;
    transition: 0.5s;
    float: left;
    position: fixed;
    top: 0;
    bottom: 0;
    white-space: nowrap;
    overflow: hidden;
    overflow-y: scroll;
    transition: 0.5s;
    z-index: 10;
  }
  nav::-webkit-scrollbar {
    display: none;
  }
  nav a, nav a:visited {
    color: grey;
  }
  nav h2:before {
    content: "≡ ";
    font-size: 150%;
  }
  nav h2:after {
    content: " ◂";
  }
  nav li {
    margin-left: 1em;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  nav li > a:not(:only-child):before {
    content: "▸ ";
  }
  nav li > a:only-child {
    margin-left: 0.75em;
  }
  nav li li {
    margin-left: 1em;
  }
  nav li li li {
    margin-left: 0.5em;
    font-size: smaller;
  }
  nav ul li ul  {
    visibility: hidden;
    display: none;
    margin-top: 0.2em;
    margin-bottom: 0.2em;
    transition: 0.5s;
  }
  .paddingleft {
    padding-left: 9cm;
    transition: 0.5s;
  }
  .navside {
    width: 7cm;
    margin-left: -8.5cm;
    padding-right: 1cm;
    transition: 0.5s;
  }
  .navside h2:after {
    content: " ▸ ";
  }
  .navshown {
    width: 50%;
    transition: 0.5s;
    background-color: rgba(255, 255, 255, 0.95);
  }
  .subShow > ul {
    visibility: visible;
    display: block;
    transition: 0.5s;
    margin-left: -1em;
  }
  .subShow > a:not(:only-child):before {
    content: " ▾ ";
  }

  .toc-invisible {
    visibility: hidden;
  }
  .navside > .toc-invisible {
    visibility: visible;
  }
  .navshown > .toc-invisible {
    visibility: visible;
  }
  </style>
</head>
<body>
<header id="title-block-header">
<h1 class="title">Phrase Bias Tutorial</h1>
</header>
<nav id="TOC" role="doc-toc">
<h2 id="toc-title">Contents</h2>
<ul>
<li><a href="#introduction">Introduction</a>
<ul>
<li><a href="#what-is-biasing">What is Biasing?</a></li>
<li><a href="#what-can-we-do-with-phrase-biasing">What Can We Do With Phrase Biasing?</a></li>
</ul></li>
<li><a href="#story-pacing">Story Pacing</a>
<ul>
<li><a href="#before">Before</a></li>
<li><a href="#settings">Settings</a></li>
<li><a href="#after">After</a></li>
</ul></li>
<li><a href="#control-novelai-grammatical-usage">Control NovelAI Grammatical Usage</a>
<ul>
<li><a href="#avoiding-using-expletives-at-the-beginning-of-sentences">Avoiding Using Expletives At The Beginning of Sentences</a></li>
<li><a href="#avoid-circumlocutions-in-favor-of-direct-expressions">Avoid Circumlocutions In Favor of Direct Expressions</a></li>
<li><a href="#avoid-overusing-noun-forms-of-verbs">Avoid Overusing Noun Forms Of Verbs</a></li>
<li><a href="#trying-it-out">Trying It Out</a></li>
</ul></li>
<li><a href="#control-the-theme-of-the-story">Control The Theme Of The Story</a>
<ul>
<li><a href="#a-story-about-rainbows-unicorns-and-girls-on-an-island">A Story About Rainbows, Unicorns, and Girls on an Island</a></li>
<li><a href="#a-worldships-first-contact">A Worldship's First Contact</a></li>
</ul></li>
<li><a href="#layering-phrase-biases">Layering Phrase Biases</a></li>
<li><a href="#notes-and-caveats">Notes and Caveats</a></li>
<li><a href="#questions-feedback-ideas">Questions, Feedback, Ideas</a></li>
</ul>
</nav>
<p>written by OccultSage, with thanks to AlexeiP, Pause, Aini, and u/sgt_brutal</p>
<p><em><strong>Note: Biases are <strong>extremely strong</strong> on Krake and Clio. You will need to reduce their intensity considerably to avoid soft bans or constant looping. It is suggested to add a 0 immediately after the decimal point compared to an Euterpe bias. Thus, 0.3 would become 0.03. Anything over 0.05 is usually too strong.</strong></em></p>
<h2 id="introduction">Introduction</h2>
<p><img src="https://github.com/TapwaveZodiac/novelaiUKB/assets/35267604/3edd60d4-29a4-405c-856f-cc8c79a3b945" alt="image" /></p>
<p>NovelAI has an advanced and powerful feature, <em>Phrase Bias</em>, that you can use to adjust the bias of <em>groups of tokens</em>. This is more powerful than the earlier <em>Logit Bias</em> feature that is available via the API but never exposed directly in the UI, as the older functionality only biases single tokens rather than groups of tokens.</p>
<p>To reach the <em>Phrase Bias</em> functionality, access the <strong>Options</strong> panel on the right hand side of the NovelAI interface, and scroll down until you get to the <strong>Advanced Options</strong> expansion. Click on that to open, and scroll down further to see the interface shown in the screenshot to the right.</p>
<p>The drop down under <em>Phrase Bias</em> is for Phrase Bias Groups that have the same biases. Phrase Groups can be added, removed, and edited. When you type in text you want to bias for such as <code>mermaid</code> and hit <code>&lt;enter&gt;</code> it will be added to the current Phrase Bias Group.</p>
<p>The slider right below the text entry allows you to bias in ranges from 'almost never' on the left hand side, to 'almost always' on the right hand side. A light touch is suggested, and the slider is non-linear to reflect this.</p>
<p>But first, before we get into how to use Phrase Biasing, let's discuss and understand what <strong>Biasing</strong> is and how it impacts on our phrases and tokens.</p>
<h3 id="what-is-biasing">What is Biasing?</h3>
<p>NovelAI at its heart is an advanced text prediction system that constructs responses one <em>token</em> at a time. The closest human language analogue for a token would be a syllable, although it does not usually map or correspond 1:1; there are words with multiple syllables that are a single token.</p>
<p>For each token, NovelAI picks from a list of probable tokens -- the token is selected from a list that is formed up influenced by:</p>
<ul>
<li>The Sigurd (GPT) model itself.</li>
<li>What text already exists in the context sent, including Story, activated Lorebook entries, Author's Note, and Memory.</li>
<li>The module in use (such as Cross-Genre, 19th Century Romance, and Lovecraft)</li>
<li>Generation settings.</li>
<li>Token bans.</li>
<li>... and now <strong>Phrase Biases</strong>.</li>
</ul>
<p>Each <em>'token</em> has a probability assigned to it by the above process. For example, if we submit: <code>The mermaid was laying on a rock in the lake</code>, the following top token probabilities are calculated:</p>
<p>Token Weight</p>
<hr />
<p><code>,</code> 17.546875 <code>.</code> 17.078125 <code>with</code> 14.8359375 <code>'s</code> 14.5 <code>and</code> 14.125 <code>as</code> 13.90625 <code>in</code> 13.8046875 <code>when</code> 13.75 <code>near</code> 13.71875 <code>at</code> 13.421875 ... ...</p>
<p>: Token Weights</p>
<p>From the above table, we can see that the two most probable tokens are <code>,</code> and <code>.</code>, and that the following two probable tokens are <code>with</code> and <code>'s</code>. The generation node then picks one of them randomly accordingly to the weights above.</p>
<p>When we generate for a number of tokens such as <code>20</code>, the above process is repeated <code>20</code> times. With Token Streaming enabled, these tokens are fed back to the NovelAI UI one at a time.</p>
<p>What if we could adjust the probabilities of these tokens? Well, with Phrase Biasing, we can!</p>
<h3 id="what-can-we-do-with-phrase-biasing">What Can We Do With Phrase Biasing?</h3>
<p>We can do many things with <strong>Phrase Biasing</strong> that does not seem obvious at first glance.</p>
<p>We can:</p>
<ul>
<li>Change the pacing of the story entirely by controlling when NovelAI finishes sentences, goes to the next paragraph, how much dialogue is generated, and how long each alternation of dialogue happens.</li>
<li>Enhance NovelAI's grammatical usage by biasing against words such as <code>as</code>, or beginning sentences with <code>He</code> or <code>She</code></li>
<li>Control how a NovelAI story starts by either biasing for or against common phrases that show up in your story.</li>
<li>Control the theme, slant, and emphasis of the story.</li>
</ul>
<p>... and much more!</p>
<h2 id="story-pacing">Story Pacing</h2>
<p>We can use Phrase Biasing to control the pacing of the story.</p>
<p><em>Credit to <a href="https://www.reddit.com/user/sgt_brutal/">https://www.reddit.com/user/sgt_brutal/</a> for his original post that crystallized my thoughts on this!</em></p>
<h3 id="before">Before</h3>
<p>We perform around ~1200 characters of generations on the default module, <em>General: Cross-Genre</em>, with the <em>Storywriter</em> preset with no biases so we can get a general feel for what the shape of the text is.</p>
<pre><code>&quot;I don&#39;t know what to say,&quot; said Lizzie. &quot;You saved my life.&quot; She looked at me and then up the street, where a woman in an old brown coat was pulling on her gloves. A man walked past us with a porter&#39;s barrow full of rubbish from some building site; he gave our taxi driver a friendly wave. I turned back to look at her, wondering how much longer we would be able to talk without being overheard or interrupted by nosy passers-by.

She had put her hand over mine when she spoke but now removed it quickly as if ashamed that she&#39;d done so. &quot;It wasn&#39;t anything heroic,&quot; she added hastily. &quot;And you didn&#39;t have to do it for me... I mean...&quot; She shrugged helplessly. Her cheeks were still pink from the cold and excitement. The wind stirred the feathers around her neck like a halo.

&quot;But I wanted to help you,&quot; I told her firmly. My own hands were trembling slightly. It was all very well for Sibyl to call herself &#39;The Great Detective,&#39; but this time I really felt that maybe I could solve the mystery too. Maybe there really was something supernatural going on here, and not just because of what had happened to Mr. Cartwright.
&quot;I&#39;m sorry about your brother,&quot; I said again. &quot;He seemed nice.&quot;

Lizzie laughed bitterly. &quot;Yeah, he did. He used to tell me stories when I was little.  But I suppose they were lies.&quot;

We sat quietly for a moment. Our taxi driver honked his horn impatiently behind us. Then Lizzie leaned forward and touched my knee lightly. &quot;Look, um, I&#39;ve got to go home now,&quot; she said. &quot;My mum will worry if I don&#39;t get back soon.&quot;
</code></pre>
<h3 id="settings">Settings</h3>
<p>There are four main tokens that control the flow of a story:</p>
<ul>
<li><code>.</code> -- a period, going onto the next sentence. If we positively bias for a period, it will cause shorter sentences; conversely, if we negatively bias against periods, it will cause longer sentences to be produced.</li>
<li><code>"</code> -- a double quotation mark; biasing for this will cause more dialogue, biasing against this will cause less dialogue. Note that this is for opening quotations at the beginning of a line.</li>
<li><code>"</code> -- a double quotation mark followed by a space; biasing for this will cause ping-pong conversations.</li>
<li><code>[198]</code> -- a line break, going onto the next paragraph. NovelAI generally talks about a subject per paragraph, so if you want more or less detailed descriptions, we can bias for or against line breaks.</li>
</ul>
<p>Let's demonstrate by typing in the following into the Phrase Bias text field:</p>
<pre><code>{.} [ENTER]
{&quot;} [ENTER]
{&quot; } [ENTER]
[198] [ENTER]
</code></pre>
<p>Once entered, let's slide the bias towards <code>-0.1</code>. Remember, a light touch is often all what's required! Make sure the <strong>Unbias When Generated</strong> checkbox is <em>disabled</em>. When done, our pane should look something like the following:</p>
<p><img src="https://github.com/TapwaveZodiac/novelaiUKB/assets/35267604/0338dec3-7310-46eb-8f93-c8c06b224907" alt="image" /></p>
<h3 id="after">After</h3>
<p>Now, we <code>Send&gt;</code> twice and see what kind of output we get!</p>
<p><strong>Bias -0.1 against:</strong></p>
<pre><code>The man&#39;s face was hidden behind a black hood, but the rest of him was exposed: his arms and legs were encased in thick leather straps that kept them immobile; he wore only shorts made from rough burlap. His skin had been shaved smooth to reveal his puckered scars where the metal plates on his skull met with his cranium. The woman beside me looked at her watch nervously as she strode forward to greet their visitor. Her hair was short, almost military-short, and her uniform matched his: black leather pants and jacket with gold trim around the cuffs and collar. She reached out for the hand gripping one of the bars inside the cage door, then pulled it open before stepping back to allow our guest entry into the room beyond. He moved slowly toward us, taking care not to touch anything or make any sudden movements—his body language betrayed an extreme level of self-consciousness about touching things that weren&#39;t supposed to be touched. I could tell he wanted nothing more than to turn tail and run away right now, but there wasn&#39;t anywhere left to go besides the street outside this windowless room. It was all too obvious what we&#39;d done wrong, so much so that even my jailers seemed uncomfortable talking to him directly.

He stopped just shy of entering the cell, staring at each of us in turn before finally settling his gaze on mine. &quot;Hello,&quot; he said simply, his voice barely audible above the buzzing of the fluorescent lights overhead. His eyes were empty and dull, like those of a dead fish.  There was no emotion in them whatsoever, which was perhaps the most disturbing thing of all about him. A hint of recognition flashed across his face when he saw me, but it vanished almost immediately after he realized who I was. Perhaps they thought I might have something useful to say if given enough time, or maybe they knew better than to waste energy trying to get through to someone whose mind had already been broken by years of solitary confinement. Whatever their reasoning, I didn&#39;t give them the satisfaction of responding to his greeting, instead returning his stare with a blank look of my own. If I couldn&#39;t communicate with him, neither would anyone else in here—not unless he managed to pull off some sort of miracle trick to break down the walls between our minds, which was highly unlikely.
</code></pre>
<p>Amazing! The paragraphs are much longer, more detailed, and have far less dialogue! Next, let's see what happens when we slide from <code>-0.1</code> to <code>+0.1</code> and hit <code>Send&gt;</code> twice:</p>
<p><strong>Bias +0.1 for:</strong></p>
<pre><code>&quot;I&#39;m sorry, you know,&quot; I said. &quot;About your brother.&quot;

He shook his head. The boy was a good deal more stoic than the old man. He had been left to grow up in solitude and without love; he would not be easily broken by my words.

&quot;It&#39;s just that... I&#39;ve never seen anyone die before.&quot;

His eyes widened slightly. It wasn&#39;t much of an answer, but it seemed like something we could work with.
&quot;So...&quot;

The boy looked at me for a moment. Then he nodded.

&quot;All right,&quot; I said. &quot;You can tell me about him. About how he died. And then maybe—maybe if I understand why—&quot;
But the boy only shook his head again.

&quot;No,&quot; he said. &quot;There is nothing else to say. My father has gone now. You will see no more of us. Go back home. Forget this place. Never come here again.&quot;

Then the boy turned away from me and walked into the house.

As soon as he closed the door behind him, I felt alone. A chill ran through my body. For a long time after that, I sat on that rock.

In all honesty, there were many things I wanted to do. There was still so much I needed to learn. But none of those things could be done until I returned to New York.

And that meant leaving.

I stood up slowly. The boy had vanished inside the house.
</code></pre>
<p>We have a completely different terse and dialogue-heavy writing style!</p>
<h2 id="control-novelai-grammatical-usage">Control NovelAI Grammatical Usage</h2>
<p>We can control how often speakers get referenced, as well as aim for better writing by biasing against or for certain words. For example, let's work from a writing advice article about common pitfalls <a href="https://owl.purdue.edu/owl/general_writing/academic_writing/conciseness/avoid_common_pitfalls.html">here</a></p>
<h3 id="avoiding-using-expletives-at-the-beginning-of-sentences">Avoiding Using Expletives At The Beginning of Sentences</h3>
<p>Expletives are phrases of the form <em>it</em> + <em>be-verb</em> or there + <em>be-verb</em>.</p>
<p><strong>Bias -0.1 against:</strong></p>
<pre><code>{It is}
{ It is}
{It was}
{ It was}
{There is}
{ There is}
{There are}
{ There are}
{There was}
{ There was}
{He}
{ He}
{She}
{ She}
{They}
{ They}
</code></pre>
<h3 id="avoid-circumlocutions-in-favor-of-direct-expressions">Avoid Circumlocutions In Favor of Direct Expressions</h3>
<p>Circumlocutions are commonly used roundabout expressions that take several words to say what could be said more succinctly.</p>
<p><strong>Bias -0.1 against:</strong></p>
<pre><code>{ At}
{At}
{ In}
{In}
</code></pre>
<h3 id="avoid-overusing-noun-forms-of-verbs">Avoid Overusing Noun Forms Of Verbs</h3>
<p>Use verbs when possible rather than noun forms known as nominalizations. Sentences with many nominalizations usually have forms of be as the main verbs.</p>
<p><strong>Bias -0.1 against:</strong></p>
<pre><code>{ function}
{ current}
{The}
{ The}
{It}
{ It}
</code></pre>
<p><strong>Bias +0.1 for:</strong></p>
<pre><code>{ because}
{ since}
{ why}
{ when}
{ about}
{ must}
{ should}
{ can}
{ may}
{ might}
{ could}
</code></pre>
<h3 id="trying-it-out">Trying It Out</h3>
<p>Let's see what kind of output we get when we hit <code>Send&gt;</code> a few times:</p>
<pre><code>&quot;You are welcome, my lady,&quot; the prince said. &quot;I would not have your father know that you were here.&quot;

Alix nodded and turned to leave when she heard someone else come in. Her heart stopped for a moment as she saw who it was: Prince Michael&#39;s older brother, Prince Stefan. His eyes widened slightly at her appearance before he recovered his composure and spoke with an awkward smile. Alix could tell from his tone of voice that he had been drinking heavily this evening but seemed determined to keep up appearances.

&quot;Your Highness.&quot; She curtsied politely and offered him a quick bow of greeting before turning back to the door. As she did so, however, she caught sight of something out of the corner of her eye—a large wooden chest sitting on one of the tables against the wall. Curious about what might be inside, she crossed over to examine it more closely. When she opened it up, she found herself staring at two small bags made of dark brown leather filled with golden coins. One bag contained twenty-four gold crowns; the other held forty-eight. Both were heavy because they must have weighed close to three pounds each. And there was no doubt about their value — these were real gold coins, stamped by a king&#39;s authority.

She closed the lid quickly and shut her eyes tightly, wishing that she could hide away in the safety of her room until morning. But she knew better than that. If anyone discovered what she had done, she would be punished severely for breaking the law. Yet, even if she managed to escape detection, she still felt guilty about stealing the money.
</code></pre>
<p>This has definitely helped improve the output that NovelAI produces! There is a lot of other things we can control as far as grammar such as the overuse of <code>As</code> or <code>as</code>; this is not intended to be comprehensive, but a starter for ideas.</p>
<h2 id="control-the-theme-of-the-story">Control The Theme Of The Story</h2>
<p>One of the most interesting things about Phrase Biasing is that we can use it to control the theme of the story.</p>
<h3 id="a-story-about-rainbows-unicorns-and-girls-on-an-island">A Story About Rainbows, Unicorns, and Girls on an Island</h3>
<p><strong>Bias +0.43 for:</strong></p>
<pre><code>rainbow
girl
pony
unicorn
island
</code></pre>
<p><strong>Sample Output:</strong></p>
<pre><code>&quot;I think it&#39;s about time you two got married,&quot; the girl said. &quot;You can&#39;t just live together forever.&quot;
That was what I wanted to say, but my mouth wouldn&#39;t work right.

The girl looked at me and laughed. Then she turned her ponytail around so that all of those black curls hung down over one shoulder like a rainbow waterfall. Her face changed when she saw them. She squinted as if trying to see something far away in the distance. When she spoke again, her voice sounded strange. &quot;What is this?&quot;

&quot;A unicorn,&quot; I whispered because nobody could hear us except for God and maybe Santa Claus. That girl must have been pretty special because even though everybody knew there were no such things as unicorn girls anymore, she didn&#39;t look scared or angry or anything. Instead, she seemed to be thinking about something else entirely. Maybe how much better off we would both be if we had never met each other? Or maybe she thought about how lucky we were to have found our unicorn friends instead of being stuck with boring old humans who couldn&#39;t appreciate their gifts? Whatever thoughts were running through her head, they made her smile.

Then suddenly, without warning, she started crying. Tears fell from her eyes and splashed onto my unicorn horn and burned into the skin underneath.

&quot;We should go home now,&quot; I told Daffodil. &quot;This girl might hurt herself.&quot;

Daffodil nodded solemnly and trotted toward the unicorn girl. As soon as he reached her, she wrapped him up in her rainbow ponytail and hugged him tight.
</code></pre>
<h3 id="a-worldships-first-contact">A Worldship's First Contact</h3>
<p>Enable <em>Ensure Completion After Start</em>.</p>
<p><strong>Bias +0.3 for:</strong></p>
<pre><code>Worldship
void
interstellar
First Contact
generation
generations
</code></pre>
<p><strong>Prompt:</strong></p>
<pre><code>The Worldship Odysseus
</code></pre>
<p><strong>Sample Output:</strong></p>
<pre><code>The Worldship Odysseus journeyed through the void, a vast interstellar vessel with more than five hundred decks and thousands of passengers. First Contact had been successful; the human race was expanding out from Earth into space, making new homes for themselves in distant solar systems and alien worlds. Ships like this one were now being built on every inhabited planet. The generation ship that would take generations to reach its destination might hold hundreds of thousands or millions of people—but not all of them could be accommodated at once. This generation ship carried only about three thousand passengers, but it was large enough to accommodate an entire village: a whole town&#39;s worth of families who must live together because there are no other alternatives.

&quot;I can&#39;t believe we&#39;re here,&quot; Sheri said as she looked down over the edge of their deck. &quot;We should have left long ago.&quot;

Ayla agreed. &quot;But when you get right down to it, why did anyone ever want to leave?&quot;

Sheri nodded toward the dark side of the Worldship. Far below them lay a star system filled with planets and moons, some of which might even support life-forms similar to humans. But none of those worlds held any real interest for her. There was nothing interesting about living on a world where everyone else is dead. And since they were going home eventually anyway, why bother waiting? Ayla felt exactly the same way.

They both stared at the stars until someone cleared his throat behind them.

&quot;Sorry,&quot; Sheri apologized quickly.
</code></pre>
<h2 id="layering-phrase-biases">Layering Phrase Biases</h2>
<p>A common difficulty that users may run into is that when they bias against or for a phrase, any other that begins with the token is much less likely.</p>
<p>For example, if an user biased for <code>explosion</code>, which tokenizes to <code>exp|losion</code>, any word that tokenizes to a start of <code>exp</code> would have a strong bias towards <code>losion</code> on the next token. Example words include <code>exp|lain</code>.</p>
<p>We can solve this with multiple biases that are layered:</p>
<ul>
<li>A bias for: <code>exp|losion</code></li>
<li>A slight bias against <code>losion</code></li>
</ul>
<p>NovelAI will generate <code>exp</code> and on the next token, the bias against <code>losion</code> will reduce the bias for <code>losion</code>.</p>
<h2 id="notes-and-caveats">Notes and Caveats</h2>
<ul>
<li>When you enter in a Phrase without enclosing in <code>{}</code>, it is preceded by a space. Most words in a sentence are preceded by a space when tokenized. But this means that starts of paragraphs or quotes escape the bias.</li>
<li>Pay attention to the <em>Unbias When Generated</em> setting! Sometimes you want this enabled, and sometimes you don't!</li>
<li><em>Ensure Completion After Start</em> can really bite you. Avoid enabling this for words with beginning tokens that are common!</li>
</ul>
<h2 id="questions-feedback-ideas">Questions, Feedback, Ideas</h2>
<p>Questions and feedback are always appreciated. Find @OccultSage on one of the many NovelAI discords!</p>
<p>You may find the links for the two bias files created as part of writing this tutorial:</p>
<ul>
<li><a href="https://cdn.discordapp.com/attachments/895192255818792970/895859354111184936/Story_Flow_Control.bias">Story Flow Control.bias</a></li>
<li><a href="https://cdn.discordapp.com/attachments/895192255818792970/895857459963519006/Better_Writing_Biases.bias">Better Writing Biases.bias</a></li>
</ul>
<!-- Javascript added by darkmode.lua to allow dark mode button -->
<script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>
<script>
  function addDarkmodeWidget() {
    const darkmode_options = {
      mixColor: '#fff', // default: '#fff'
      backgroundColor: '#fff',  // default: '#fff'
      buttonColorDark: '#100f2c',  // default: '#100f2c'
      buttonColorLight: '#fff', // default: '#fff'
      label: '🌓',
    }

    new Darkmode(darkmode_options).showWidget();
  }
  window.addEventListener('load', addDarkmodeWidget);
</script>


<!-- Javascript added by toc-css.lua to make TOC expandable on click -->
<script>

  const b = document.querySelector("body");
  const n = document.querySelector("nav");
  const buttonsize = 15;

  // click on "toc-title" to show TOC to the side
  document.querySelector("#toc-title").addEventListener("click", function(e) {
    if (e.clientX < e.currentTarget.getBoundingClientRect().left + buttonsize) {
      n.classList.toggle("navshown");
    } else {
      b.classList.toggle("paddingleft");
      n.classList.toggle("navside");
      n.classList.remove("navshown");
    };
  });

  // by default show TOC in large window
  window.onload = function() {
    if (window.innerWidth > 1000) {
      b.classList.add("paddingleft");
      n.classList.add("navside");
    };
  };

  // show/hide TOC on resize
  window.onresize = function () {
    if (window.innerWidth > 1000) {
      b.classList.add("paddingleft");
      n.classList.add("navside");
    } else {
      b.classList.remove("paddingleft");
      n.classList.remove("navside");
    };
  };

  // show/hide subsections
  const allLis = document.querySelectorAll("nav li");

  for (const li of allLis) {
    li.addEventListener('click', function (e) {
      // show/hide subsection if arrow is clicked
      if (e.clientX < e.currentTarget.getBoundingClientRect().left + buttonsize
        && e.clientY < e.currentTarget.getBoundingClientRect().top + buttonsize) {

        li.classList.toggle('subShow');
        e.preventDefault();
      };

      // hide full nav if clicked outside
      if (e.currentTarget.getBoundingClientRect().left + 3*buttonsize < e.clientX) {
        n.classList.remove("navshown");
      };
    });

    li.classList.add('subShow');
  };

  // hide ToC if no overruling
  document.querySelector("nav ul").classList.add("toc-invisible");

  // show full nav on tab, hide full nav on escape
  document.addEventListener("keydown", function (e) {
    if (e.which === 27) {
      n.classList.remove("navshown");
      e.preventDefault();
    };
    if (e.which === 9) {
      n.classList.add("navshown");
      e.preventDefault();
    };
  });

  // insert key info
  n.insertAdjacentHTML("beforeend", "<span class='toc-invisible'> \
                                     <br/> \
                                     <p>Press <kbd>Tab</kbd> to show extended width TOC.</p> \
                                     <p>Presss <kbd>Esc</kbd> to go back to normal width.</p> \
                                     </span>");

  // hide full nav when clicked outside
  document.addEventListener("click", function(e) {
    if (n.classList.contains("navshown")) {
      if (!n.contains(e.target)) {
        n.classList.remove("navshown");
      };
    };
  });

</script>
</body>
</html>
